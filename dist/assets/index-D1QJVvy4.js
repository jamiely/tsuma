(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const x=["red","green","blue","gold","purple"],m=()=>x[Math.floor(Math.random()*x.length)],b=(e,t)=>{const n=e.x-t.x,i=e.y-t.y;return Math.sqrt(n*n+i*i)},B=(e,{position:t,size:n})=>!(e.x<t.x||e.x>t.x+n.width||e.y<t.y||e.y>t.y+n.height),y=({x:e,y:t})=>Math.sqrt(e*e+t*t),C=(e,t)=>{e.x+=t.x,e.y+=t.y},u=(e,t)=>{e.x-=t.x,e.y-=t.y},p=(e,t)=>{e.x*=t,e.y*=t},f=e=>{const t=y(e);e.x/=t,e.y/=t},g=(e,t)=>{e.x=t.x,e.y=t.y},E=e=>t=>{const{chains:n,freeBalls:i,ballRadius:o}=t,s=e.getContext("2d");if(!s){console.error("There is no 2d context available.");return}s.fillStyle="white",s.fillRect(0,0,e.width,e.height),I(s,t);for(let r=0;r<n.length;r++){let l=n[r].head;for(;l;)v(s,o)(l.ball),l=l.next}i.forEach(v(s,o)),D(s,t)},T=2*Math.PI,I=(e,t)=>t.paths.forEach(n=>{e.beginPath();const{start:i}=n;let o,s=i;for(;s;)e.beginPath(),e.arc(s.value.x,s.value.y,2,0,T),e.fillStyle="lightgray",e.fill(),o&&(e.beginPath(),e.setLineDash([5,15]),e.moveTo(o.value.x,o.value.y),e.lineTo(s.value.x,s.value.y),e.strokeStyle="lightgray",e.stroke()),o=s,s=s.next}),v=(e,t)=>({position:{x:n,y:i},color:o})=>{e.beginPath(),e.arc(n,i,t,0,T),e.fillStyle=o,e.fill()},D=(e,t)=>{const i=t.launcher;v(e,t.ballRadius)(i);const{position:o,pointTo:s}=i,r={...s};u(r,o),f(r),p(r,30),C(r,o),e.beginPath(),e.setLineDash([]),e.strokeStyle="black",e.moveTo(o.x,o.y),e.lineTo(r.x,r.y),e.stroke()};function A(e){const{chains:t,freeBalls:n}=e,i=L(e);let o=!1;do{o=!1;e:for(let s=n.length-1;s>=0;s--)for(let r=t.length-1;r>=0;r--){let l=t[r].head;for(;l;){if(!l.collidable||!i(n[s],l.ball)){l=l.next;continue}t[r].inserting++;const{position:a,color:d}=n[s],c={collidable:!0,ball:{color:d,position:a,prevPosition:a},waypoint:l.waypoint,insertion:{position:a}};let h=l.previous;c.previous=l.previous,c.next=l,l.previous.next=c,l.previous=c,h&&(c.waypoint=h.waypoint,c.insertion.position={...h.ball.position}),n.splice(s,1),o=!0;break e}}}while(o)}const L=e=>{const t=e.ballRadius*2;return(n,i)=>t>b(n.position,i.position)};function M(e){N(e),R(e)}function R(e){e.freeBalls.forEach(t=>{t.position.x+=t.velocity.x,t.position.y+=t.velocity.y});for(let t=e.freeBalls.length-1;t>=0;t--)B(e.freeBalls[t].position,e.bounds)||e.freeBalls.splice(t,1)}function N(e){const{chains:t}=e;for(let n=0;n<t.length;n++){if(t[n].inserting){O(e,t[n]);continue}_(e,t[n])}}function O(e,t){let n=t.head;for(;n;)n.insertion&&F({game:e,chain:t,chainedBall:n}),n=n.next}function F({game:e,chain:t,chainedBall:n}){const{insertionComplete:i}=z(e,n);for(;n.previous&&L(e)(n.ball,n.previous.ball);){let o=n.previous;for(;o;)w(o,e),o=o.previous;console.log("updatePositionTowardsWaypoint")}i&&t.inserting--}function _(e,t){w(t.head,e);let n=t.head.next;for(;n;)w(n,e),n=n.next;if(!B(t.head.ball.position,e.bounds)){const i=t.head.next;i&&(t.head=i,t.head.previous=void 0)}}function S({ball:{prevPosition:e,position:t}}){e.x=t.x,e.y=t.y}function w(e,t){if(S(e),!e.waypoint)return;const{ball:{position:n},waypoint:{value:i}}=e,o={...i};u(o,n),f(o),p(o,t.options.chainedBallSpeed),n.x+=o.x,n.y+=o.y,b(i,n)<1&&(e.waypoint=e.waypoint.next)}function z(e,t){const{ball:{position:n},insertion:i}=t;if(!i)throw"do not call updatePositionTowardsInsertion unless inserting";const{position:o}=i;S(t);const s={...o};u(s,n),f(s),p(s,e.options.launchedBallSpeed);const r={...n},l={...r},a={...n};C(r,s),u(l,o),u(a,o),y(l)>y(a)?g(n,o):g(n,r);const d=Math.max(1,e.options.launchedBallSpeed/2);return b(o,n)<d?(t.insertion=void 0,{insertionComplete:!0}):{insertionComplete:!1}}const q=e=>{const t=e(),n={value:t.next().value};let i=n;do{let{done:o,value:s}=t.next();if(o)break;const r={value:s,previous:i};i.next=r,i=r}while(!0);return{start:n,end:i}},W=(e,t)=>{const n=Math.PI*16;return function*(){for(let i=t;i<=e.bounds.size.width+50;i+=n)yield{x:i,y:Math.sin(.01*i)*100+200}}},G="#f8f9f9",P=G,k=({game:e,length:t,waypointPath:n})=>{const i=n.start.next,o={collidable:!1,waypoint:i,ball:{position:{...n.start.value},prevPosition:{...n.start.value},color:P}};let s=o;for(let r=0;r<=t;r++){const l=r===t,a={...s.ball.position};u(a,{x:e.ballRadius*2+2,y:0});const d={collidable:!l,waypoint:i,ball:{position:a,prevPosition:a,color:l?P:m()},previous:s};s.next=d,s=d}return{head:o,foot:s,path:n,inserting:0}},H=()=>{const t={options:{chainedBallSpeed:1.5,launchedBallSpeed:4,firingDelay:300},ballRadius:10,chains:[],launcher:{prevPosition:{x:300,y:300},position:{x:300,y:300},pointTo:{x:0,y:0},color:"purple",launcherSpeed:4},freeBalls:[],bounds:{position:{x:0,y:0},size:{width:800,height:400}},paths:[],lastFire:0},n=q(W(t,100));t.paths.push(n);const i=k({game:t,headPosition:{x:200,y:200},length:8,waypointPath:n});return t.chains.push(i),t},U=({pointTo:e,position:t,launcherSpeed:n})=>{const i={...e};return u(i,t),f(i),p(i,n),i},Y=e=>{const{launcher:t,freeBalls:n}=e,i=Date.now();i-e.lastFire<e.options.firingDelay||(e.lastFire=i,n.push({position:{...t.position},prevPosition:{...t.position},velocity:U(t),color:m()}))};function $(e){M(e),A(e)}const K=e=>t=>{t.addEventListener("mousemove",n=>{e.launcher.pointTo={x:n.offsetX,y:n.offsetY}}),t.addEventListener("mousedown",()=>{Y(e)})};function V(){const e=H();document.querySelector("#app").innerHTML=`
    <div>
      <canvas 
        id="game" 
        width="${e.bounds.position.x+e.bounds.size.width}" 
        height="${e.bounds.position.y+e.bounds.size.height}" />
    </div>
  `;const t=document.getElementById("game");K(e)(t);function n(){requestAnimationFrame(()=>{$(e),E(t)(e),n()})}n()}V();
